<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Rock Legends - Favorite Bands</title>
  <link rel="stylesheet" href="rockband_expanded.css" />

<style>
  .youtube-playlists { display: grid; gap: 14px; }
  .yt-card { background: rgba(255,255,255,0.06); border: 1px solid rgba(255,255,255,0.12); border-radius: 12px; overflow: hidden; }
  .yt-meta { display:flex; gap: 12px; padding: 12px; align-items: center; }
  .yt-thumb { width: 96px; height: 54px; object-fit: cover; border-radius: 8px; flex: 0 0 auto; }
  .yt-text { min-width: 0; }
  .yt-title { font-weight: 700; line-height: 1.25; }
  .yt-channel { opacity: 0.85; font-size: 0.9em; margin-top: 4px; }
  .yt-player iframe { width: 100%; aspect-ratio: 16 / 9; display:block; }
  .loading, .error, .empty { padding: 12px; opacity: 0.9; }
  .error { border-top: 1px solid rgba(255,80,80,0.35); }
</style>

</head>
<body>
  <div class="header">
    <div class="logo">ROCK LEGENDS</div>
    <nav class="nav">
      <a href="index.html">Home</a>
      <a href="index.html">Country</a>
      <a href="index.html">Genre</a>
      <a href="favorite_bands.html" style="text-decoration:underline;">Favorite Bands</a>
    </nav>
  </div>

  <main class="main container">
    <section class="section">
      <h2>내 Favorite Bands</h2>
      <p class="favorites-note">
        메인 타임라인 카드 아래의 ☆ 버튼을 누르면 여기 목록에 저장됩니다.
      </p>
      <div id="favoriteBands" class="bands"></div>
      <div id="noFavorites" class="empty" style="display:none;">
        아직 즐겨찾기한 밴드가 없습니다.<br>
        Home 화면에서 별표 버튼을 눌러 즐겨찾기를 추가해보세요.
      </div>
    </section>

    <section class="section" id="favoriteDetailSection" style="display:none;">
      <h2 id="detailBandName">선택한 밴드</h2>
      <div id="detailInfo" class="card"></div>
    </section>

    <section class="section" id="youtubeSection" style="display:none;">
  <h2>YouTube 플레이리스트 추천</h2>
  <p class="hint" style="margin-top:-6px; opacity:0.85;">
    YouTube Data API로 밴드 관련 플레이리스트를 검색해 보여줍니다.
  </p>
  <div id="youtubePlaylists" class="youtube-playlists"></div>
</section>
  </main>

  <footer class="footer">
  © 1960-2025 Rock Legends ·
  <a href="credits.html">Image Credits</a>
</footer>

<script>
  const FAVORITES_KEY = 'rocklegends_favorites_v1';


// ------------------ YouTube Data API 설정 ------------------
// 1) Google Cloud Console에서 YouTube Data API v3를 활성화
// 2) API 키를 발급한 뒤 아래에 붙여넣기
// ⚠️ 프론트에 키를 넣으면 노출됩니다. (도메인 제한/쿼터 설정 권장)
const YT_API_KEY = 'AIzaSyDee4vsjZIFXLepNDdLRnw_6-QZMlYYgpk';
const YT_MAX_RESULTS = 3;

  // 메인 페이지와 동일한 약력(필요한 밴드만 사용됨)
const BAND_BIOS = {
  "Beatles": `
    <p>리버풀 출신의 전설적인 록 밴드로, 1960년대 대중음악의 흐름을 바꿨습니다.</p>
    <p>멜로디와 실험성을 동시에 보여주며 이후 수많은 아티스트에게 영향을 남겼습니다.</p>
  `,

  "Rolling Stones": `
    <p>블루스 기반 록앤롤의 아이콘으로, 거친 사운드와 카리스마로 사랑받았습니다.</p>
    <p>장기간 활동하며 라이브 퍼포먼스와 록의 태도를 상징하는 존재가 되었습니다.</p>
  `,

  "Led Zeppelin": `
    <p>하드 록/헤비메탈의 원형을 제시한 영국 밴드입니다.</p>
    <p>강력한 리프와 다이내믹한 구성으로 ‘클래식 록’의 대표적인 기준점이 되었습니다.</p>
  `,

  "Pink Floyd": `
    <p>프로그레시브 록의 정점으로 꼽히는 밴드이며, 실험적 사운드와 개념 앨범으로 유명합니다.</p>
    <p>사운드 디자인과 서사적 구성으로 ‘앨범 단위 감상’의 매력을 극대화했습니다.</p>
  `,

  "KISS": `
    <p>화려한 분장과 퍼포먼스로 유명한 하드 록 밴드입니다.</p>
    <p>무대 연출과 캐릭터성을 결합해 ‘쇼’로서의 록 공연을 대중적으로 확장했습니다.</p>
  `,

  "Nirvana": `
    <p>그란지 록의 상징으로, 1990년대 얼터너티브 록 대중화에 결정적 역할을 했습니다.</p>
    <p>거칠지만 직설적인 감정 표현으로 당시 세대의 정서를 대표하는 밴드가 되었습니다.</p>
  `,

  "Oasis": `
    <p>브릿팝의 아이콘으로, 직선적인 멜로디와 태도로 세대를 관통했습니다.</p>
    <p>큰 후렴과 강한 ‘싱얼롱’ 감성으로 1990년대 영국 록의 중심에 섰습니다.</p>
  `,

  "L'Arc~en~Ciel": `
    <p>일본 록을 대표하는 밴드로, 멜로디와 비주얼 모두 강점으로 평가받습니다.</p>
    <p>다채로운 사운드 스펙트럼과 세련된 곡 전개로 폭넓은 팬층을 형성했습니다.</p>
  `,

  "Linkin Park": `
    <p>뉴메탈과 일렉트로니카의 결합으로 2000년대 초반을 장악한 밴드입니다.</p>
    <p>강한 에너지와 감정선이 뚜렷한 보컬 스타일로 대중성과 공격성을 동시에 잡았습니다.</p>
  `,

  "Coldplay": `
    <p>서정적 멜로디와 감성적 사운드로 사랑받는 영국 밴드입니다.</p>
    <p>부드러운 분위기부터 웅장한 스케일까지 확장하며 ‘모던 팝 록’의 대표 주자가 되었습니다.</p>
  `,

  "Asian Kung-Fu Generation": `
    <p>에모/얼터너티브 기반의 일본 록 밴드입니다.</p>
    <p>선명한 기타 사운드와 직관적인 곡 구성으로 많은 리스너에게 꾸준히 사랑받고 있습니다.</p>
  `,

  "Imagine Dragons": `
    <p>팝 록/일렉트로닉 록을 성공적으로 결합한 밴드입니다.</p>
    <p>강한 비트와 후렴 중심의 구성이 특징이며, 대중적인 에너지로 큰 호응을 얻었습니다.</p>
  `,

  "Arctic Monkeys": `
    <p>인디/개러지 록 기반의 현대적 사운드를 선도한 밴드입니다.</p>
    <p>시기별로 스타일을 유연하게 확장하면서도 특유의 감각적인 분위기를 유지했습니다.</p>
  `,

  "Måneskin": `
    <p>Måneskin은 이탈리아 출신 록 밴드로, 하드 록과 팝 록, 얼터너티브 록을 기반으로 활동하고 있습니다.</p>
    <p>과거 록 음악을 현대적으로 재해석하는 스타일을 특징으로 하며, 다양한 아티스트에게서 영향을 받은 것으로 알려져 있습니다.</p>
  `,

  "Greta Van Fleet": `
    <p>클래식 록의 계보를 현대적으로 잇는 밴드입니다.</p>
    <p>빈티지한 질감의 사운드와 강한 밴드 연주를 중심으로 존재감을 보여줍니다.</p>
  `,

  "King Gnu": `
    <p>장르 경계를 넘나드는 일본 밴드입니다.</p>
    <p>록을 기반으로 하면서도 다양한 편곡과 질감으로 독자적인 색을 만들어갑니다.</p>
  `,

  "The Beach Boys": `
    <p>캘리포니아 사운드의 상징으로, 서프 록/선샤인 팝 계열의 이미지로 널리 알려져 있습니다.</p>
    <p>밝은 하모니와 세련된 편곡으로 ‘팝 보컬 그룹’의 기준을 확장했습니다.</p>
  `,

  "X Japan": `
    <p>일본 비주얼계의 선구자로, 헤비메탈과 발라드의 극적인 대비로 유명합니다.</p>
    <p>강렬한 무대성과 감성적인 멜로디를 함께 보여주며 큰 영향력을 남겼습니다.</p>
  `,

  "U2": `
    <p>아일랜드 출신의 록 밴드로, 사회적 메시지를 담은 음악과 혁신적인 사운드로 세계적인 명성을 얻었습니다.</p>
    <p>공연 규모와 사운드 연출 면에서도 ‘스타디움 록’의 대표 주자로 자주 언급됩니다.</p>
  `,

  "Metallica": `
    <p>미국의 헤비메탈 밴드로, 스래시 메탈 장르를 대표하는 이름 중 하나입니다.</p>
    <p>강렬한 사운드와 탄탄한 연주로 메탈의 대중적 확장에도 큰 역할을 했습니다.</p>
  `
};

    function getFavorites() {
    try {
      const raw = localStorage.getItem(FAVORITES_KEY);
      return raw ? JSON.parse(raw) : [];
    } catch (e) {
      return [];
    }
  }

  const favoriteBandsEl = document.getElementById('favoriteBands');
  const noFavoritesEl   = document.getElementById('noFavorites');
  const detailSection   = document.getElementById('favoriteDetailSection');
  const detailBandName  = document.getElementById('detailBandName');
  const detailInfoEl    = document.getElementById('detailInfo');
    const youtubeSection = document.getElementById('youtubeSection');
  const youtubePlaylistsEl = document.getElementById('youtubePlaylists');

  function renderFavoriteList() {
    const list = getFavorites();
    favoriteBandsEl.innerHTML = '';

    if (!list.length) {
      noFavoritesEl.style.display = 'block';
      detailSection.style.display = 'none';
      youtubeSection.style.display = 'none';
      return;
    }
    noFavoritesEl.style.display = 'none';

    list.forEach(b => {
      const card = document.createElement('div');
      card.className = 'card';

      const thumb = document.createElement('div');
      thumb.className = 'thumb';
      thumb.textContent = b.name.split(' ')[0];

      const body = document.createElement('div');
      body.className = 'body';
      body.innerHTML = `
        <div class="band-name">${b.name}</div>
        <div class="meta">${b.country} · ${b.year || ''}s · ${b.genre}</div>
        <div class="track">${b.note || ''}</div>
      `;

      card.appendChild(thumb);
      card.appendChild(body);

      card.addEventListener('click', () => {
        showFavoriteDetail(b);
      });

      favoriteBandsEl.appendChild(card);
    });
  }

  function showFavoriteDetail(band) {
    detailSection.style.display = 'block';
    detailBandName.textContent = band.name;

    // 상세 정보 카드 (메인 확장 레이아웃 느낌 유지)
    detailInfoEl.innerHTML = `
      <div class="body">
        <div class="band-name">${band.name}</div>
        <div class="meta">${band.country} · ${band.year || ''}s · ${band.genre}</div>
        <div class="track">${band.note || ''}</div>
      </div>
      <div class="expand">
        <div class="expand-layout">
          <div class="bio">
            ${BAND_BIOS[band.name] || '약력이 아직 없습니다.'}
          </div>
          ${band.img ? `<img class="band-cover" src="${band.img}" alt="${band.name} cover" />` : ``}
        </div>
      </div>
    `;

    loadYouTubePlaylists(band.name);
  }

// ------------------ YouTube 플레이리스트 추천 ------------------
async function searchYouTubePlaylists(query, maxResults = YT_MAX_RESULTS) {
  if (!YT_API_KEY || YT_API_KEY === 'YOUR_YOUTUBE_DATA_API_KEY_HERE') {
    throw new Error('YouTube API 키가 설정되지 않았습니다. YT_API_KEY를 채워주세요.');
  }

  const q = encodeURIComponent(query);
  const url =
    `https://www.googleapis.com/youtube/v3/search` +
    `?part=snippet&type=playlist&maxResults=${maxResults}&q=${q}&key=${YT_API_KEY}`;

  const res = await fetch(url);
  if (!res.ok) {
    const text = await res.text().catch(() => '');
    throw new Error(`YouTube API 오류: ${res.status} ${res.statusText} ${text}`.trim());
  }
  const data = await res.json();

  return (data.items || [])
    .map(item => ({
      playlistId: item?.id?.playlistId,
      title: item?.snippet?.title || 'Untitled',
      channelTitle: item?.snippet?.channelTitle || '',
      thumbnail:
        item?.snippet?.thumbnails?.medium?.url ||
        item?.snippet?.thumbnails?.default?.url ||
        ''
    }))
    .filter(x => x.playlistId);
}

async function loadYouTubePlaylists(bandName) {
  youtubeSection.style.display = 'block';
  youtubePlaylistsEl.innerHTML = '<div class="loading">YouTube 플레이리스트를 불러오는 중...</div>';

  // 검색 키워드 튜닝: playlist / greatest hits 등을 섞어 정확도를 약간 올림
  const query = `${bandName} playlist`;

  try {
    const items = await searchYouTubePlaylists(query, YT_MAX_RESULTS);

    if (!items.length) {
      youtubePlaylistsEl.innerHTML =
        '<div class="empty">추천할 플레이리스트를 찾지 못했습니다. 다른 밴드를 선택해보세요.</div>';
      return;
    }

    youtubePlaylistsEl.innerHTML = items.map(p => `
      <div class="yt-card">
        <div class="yt-meta">
          ${p.thumbnail ? `<img class="yt-thumb" src="${p.thumbnail}" alt="">` : ''}
          <div class="yt-text">
            <div class="yt-title">${escapeHtml(p.title)}</div>
            <div class="yt-channel">${escapeHtml(p.channelTitle)}</div>
          </div>
        </div>
        <div class="yt-player">
          <iframe
            src="https://www.youtube.com/embed/videoseries?list=${encodeURIComponent(p.playlistId)}"
            title="${escapeHtml(p.title)}"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            allowfullscreen>
          </iframe>
        </div>
      </div>
    `).join('');

  } catch (err) {
    console.error(err);
    youtubePlaylistsEl.innerHTML = `
      <div class="error">
        YouTube 플레이리스트를 불러오지 못했습니다.<br>
        <small>${escapeHtml(String(err.message || err))}</small>
      </div>`;
  }
}

// XSS 방지용 간단 이스케이프
function escapeHtml(str) {
  return String(str)
    .replaceAll('&', '&amp;')
    .replaceAll('<', '&lt;')
    .replaceAll('>', '&gt;')
    .replaceAll('"', '&quot;')
    .replaceAll("'", '&#039;');
}


  // 초기 렌더
  renderFavoriteList();
</script>
</body>
</html>
