<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Image Credits - Rock Legends</title>
  <link rel="stylesheet" href="rockband_expanded.css" />
</head>
<body>
  <div class="header">
    <div class="logo">ROCK LEGENDS</div>
    <nav class="nav">
      <a href="index.html">Home</a>
    </nav>
  </div>

  <main class="container">
    <section class="section">
      <h1>Image Credits</h1>
      <p class="muted">
        이 페이지는 Wikimedia Commons의 자유 라이선스 이미지를 사용하며,
        각 밴드별로 <strong>Commons 파일 링크 / 작성자(credit) / 라이선스</strong>를 표기합니다.
      </p>

      <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
        <button id="clearCacheBtn" class="btn">캐시 삭제 후 다시 불러오기</button>
        <span id="creditsProgress" class="muted">준비 중…</span>
      </div>

      <div id="creditsRoot" style="margin-top:16px;"></div>

      <p class="muted" style="margin-top:18px;">
        모든 표기는 Commons 메타데이터(extmetadata)를 기반으로 자동 생성됩니다.
        사이트의 내용은 해당 저작물의 보증/승인을 의미하지 않습니다.
      </p>
    </section>
  </main>

  <footer class="footer">
    © 1960-2025 Rock Legends
  </footer>

  <script src="commons_autofill.js"></script>
  <script>
    const DECADES = {
  "1960": ["Beatles", "Rolling Stones", "The Who", "The Kinks", "The Doors", "The Jimi Hendrix Experience", "Creedence Clearwater Revival", "Jefferson Airplane", "The Beach Boys", "The Spiders"],
  "1970": ["Led Zeppelin", "Pink Floyd", "KISS", "Queen", "Black Sabbath", "Deep Purple", "Eagles", "Van Halen", "PFM", "Southern All Stars"],
  "1980": ["X Japan", "U2", "Metallica", "Iron Maiden", "Def Leppard", "Guns N' Roses", "Bon Jovi", "The Cure", "BOØWY", "Litfiba"],
  "1990": ["Nirvana", "Oasis", "L'Arc~en~Ciel", "Pearl Jam", "Green Day", "Red Hot Chili Peppers", "Blur", "Radiohead", "GLAY", "Afterhours"],
  "2000": ["Linkin Park", "Coldplay", "Asian Kung-Fu Generation", "The Strokes", "The White Stripes", "Muse", "Arctic Monkeys", "The Killers", "ONE OK ROCK", "Lacuna Coil"],
  "2010": ["Imagine Dragons", "Twenty One Pilots", "Royal Blood", "The 1975", "Bring Me The Horizon", "Florence + The Machine", "BABYMETAL", "MAN WITH A MISSION", "BAND-MAID", "Thegiornalisti"],
  "2020": ["Måneskin", "Greta Van Fleet", "King Gnu", "Pinguini Tattici Nucleari", "Fast Animals and Slow Kids", "Turnstile", "Wet Leg", "Sleep Token", "The Last Dinner Party", "Official HIGE DANdism"]
};

    function el(tag, attrs={}, children=[]) {
      const node = document.createElement(tag);
      for (const [k,v] of Object.entries(attrs||{})) {
        if (k === 'class') node.className = v;
        else if (k === 'text') node.textContent = v;
        else node.setAttribute(k, v);
      }
      for (const ch of children) node.appendChild(ch);
      return node;
    }

    async function buildCredits() {
      const root = document.getElementById('creditsRoot');
      const progress = document.getElementById('creditsProgress');

      if (!window.RockLegendsCommons) {
        progress.textContent = "commons_autofill.js 로드 실패(경로 확인 필요)";
        return;
      }

      root.innerHTML = "";
      const decadeKeys = Object.keys(DECADES).sort();

      // 총 개수 계산
      const total = decadeKeys.reduce((s,k)=> s + (DECADES[k]||[]).length, 0);
      let done = 0;
      progress.textContent = `불러오는 중… (0/${total})`;

      for (const decade of decadeKeys) {
        const title = el('h2', { text: `${decade}s` });
        title.style.marginTop = "18px";

        const ul = el('ul', { class: 'image-credits' });
        root.appendChild(title);
        root.appendChild(ul);

        const names = DECADES[decade] || [];

        await window.RockLegendsCommons.mapLimit(
          names,
          3,
          async (name) => {
            const meta = await window.RockLegendsCommons.ensureBandImageAndMeta(name, decade);
            // ensureBandImageAndMeta는 missing도 반환하므로 buildCreditLi에 그대로 전달 가능
            const li = window.RockLegendsCommons.buildCreditLi(meta);
            ul.appendChild(li);
            done += 1;
            progress.textContent = `불러오는 중… (${done}/${total})`;
          }
        );
      }

      progress.textContent = `완료! (${done}/${total})`;
    }

    document.getElementById('clearCacheBtn').addEventListener('click', () => {
      try {
        window.RockLegendsCommons.clearCache();
      } catch {}
      location.reload();
    });

    window.addEventListener('DOMContentLoaded', buildCredits);
  </script>
</body>
</html>
